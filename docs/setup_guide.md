# Руководство по настройке HVAC Scripts

## Быстрый старт

### 1. Подготовка AutoCAD

#### Создание блока-шаблона помещения:

1. **Откройте AutoCAD** и создайте новый чертеж
2. **Нарисуйте графику блока** (например, прямоугольник):
   ```
   Команда: RECTANG
   Первый угол: 0,0
   Противоположный угол: 50,30
   ```

3. **Создайте определения атрибутов**:
   ```
   Команда: ATTDEF
   
   Атрибут 1:
   - Тег: ROOM_NUM
   - Подсказка: Номер помещения
   - Значение по умолчанию: 101
   - Режим: Видимый
   - Размещение: левый верхний угол прямоугольника
   
   Атрибут 2:
   - Тег: ROOM_NAME
   - Подсказка: Наименование помещения
   - Значение по умолчанию: Помещение
   - Режим: Видимый
   - Размещение: под номером помещения
   
   Атрибут 3:
   - Тег: AREA
   - Подсказка: Площадь
   - Значение по умолчанию: 25.0
   - Режим: Видимый
   - Размещение: правый верхний угол
   
   Атрибут 4:
   - Тег: AIR_IN
   - Подсказка: Приток воздуха
   - Значение по умолчанию: 150
   - Режим: Видимый
   - Размещение: левый нижний угол
   
   Атрибут 5:
   - Тег: AIR_OUT
   - Подсказка: Вытяжка воздуха
   - Значение по умолчанию: 130
   - Режим: Видимый
   - Размещение: центр нижней стороны
   
   Атрибут 6:
   - Тег: HEAT_LOSS
   - Подсказка: Теплопотери
   - Значение по умолчанию: 1200
   - Режим: Видимый
   - Размещение: правый нижний угол
   ```

4. **Создайте блок**:
   ```
   Команда: BLOCK
   Имя блока: ROOM_DATA
   Базовая точка: 0,0
   Выберите объекты: выделите прямоугольник и все атрибуты
   ```

### 2. Подготовка Excel файла

Создайте таблицу Excel со следующими колонками:

| Номер помещения | Наименование | Площадь, м² | Приток, м³/ч | Вытяжка, м³/ч | Теплопотери, Вт |
|----------------|--------------|-------------|--------------|---------------|-----------------|
| 101 | Офис главного инженера | 25.5 | 150 | 130 | 1200 |
| 102 | Конференц-зал | 45.0 | 450 | 400 | 2800 |
| 103 | Кабинет проектировщика | 18.2 | 110 | 90 | 950 |

**Для размещения по координатам** добавьте колонки:

| ... | X координата | Y координата |
|-----|-------------|-------------|
| ... | 100 | 200 |
| ... | 250 | 200 |
| ... | 400 | 200 |

### 3. Запуск программы

1. **Откройте AutoCAD** с чертежом, содержащим блок-шаблон
2. **Установите зависимости**:
   ```bash
   pip install -r requirements.txt
   ```
3. **Запустите программу**:
   ```bash
   python main.py
   ```

## Сценарии использования

### Сценарий 1: Обновление существующих блоков

**Когда использовать:** У вас уже есть блоки помещений в чертеже, нужно обновить их данные.

**Шаги:**
1. Разместите блоки в чертеже с заполненными номерами помещений
2. Подготовьте Excel с данными (номера должны совпадать)
3. Запустите программу, выберите режим "Обновить существующие блоки"

### Сценарий 2: Создание блоков по сетке

**Когда использовать:** Нужно создать множество блоков для технических расчетов или каталогов.

**Шаги:**
1. Создайте блок-шаблон в чертеже
2. Подготовьте Excel с данными помещений
3. Запустите программу, выберите "Создать новые блоки из шаблона"
4. Выберите "По сетке (автоматически)"
5. Задайте параметры сетки

### Сценарий 3: Создание блоков по координатам

**Когда использовать:** Блоки должны быть размещены в точных позициях согласно проекту.

**Способ 1 - ввод координат вручную:**
1. Создайте блок-шаблон в чертеже
2. Подготовьте Excel с данными помещений
3. Запустите программу
4. Выберите "В заданных координатах"
5. Вводите координаты для каждого помещения

**Способ 2 - координаты из Excel:**
1. Добавьте в Excel колонки "X координата" и "Y координата"
2. Измените в `config/block_mapping.json`:
   ```json
   "excel_columns": {
     "coordinate_x": "X координата",
     "coordinate_y": "Y координата"
   }
   ```
3. Запустите программу (будет автоматически использовать координаты из Excel)

## Настройка под ваши блоки

### Изменение имен атрибутов

Если ваши блоки имеют другие имена атрибутов, отредактируйте `config/block_mapping.json`:

```json
{
  "block_attributes": {
    "room_number": "ВАШ_АТРИБУТ_НОМЕРА",
    "room_name": "ВАШ_АТРИБУТ_НАЗВАНИЯ",
    "area": "ВАШ_АТРИБУТ_ПЛОЩАДИ"
  }
}
```

### Изменение имен блоков

Если ваши блоки имеют другие имена:

```json
{
  "target_blocks": [
    "ВАШ_БЛОК_ПОМЕЩЕНИЯ",
    "CUSTOM_ROOM"
  ]
}
```

### Изменение структуры Excel

Если колонки в Excel имеют другие названия:

```json
{
  "excel_columns": {
    "room_number": "№ пом.",
    "room_name": "Название помещения",
    "area": "S, м²"
  }
}
```

## Устранение проблем

### Программа не находит AutoCAD
- Убедитесь, что AutoCAD запущен
- Проверьте, что открыт хотя бы один документ

### Не находятся блоки для шаблона
- Проверьте имена блоков в `target_blocks`
- Убедитесь, что блоки не являются внешними ссылками

### Блоки создаются, но атрибуты пустые
- Проверьте имена атрибутов в `block_attributes`
- Убедитесь, что атрибуты в блоке видимые

### Ошибки чтения Excel
- Проверьте названия колонок в `excel_columns`
- Убедитесь, что файл Excel не открыт в другой программе

## Дополнительные возможности

### Пакетная обработка файлов

Для обработки нескольких Excel файлов, модифицируйте `main.py`:

```python
excel_files = ["file1.xlsx", "file2.xlsx", "file3.xlsx"]
for file_path in excel_files:
    room_data = excel_reader.read_room_data(file_path)
    # Обработка каждого файла
```

### Интеграция с базами данных

Добавьте в `excel_reader.py` функцию чтения из базы данных:

```python
def read_from_database(connection_string):
    # Подключение к базе данных
    # Чтение данных
    # Возврат в том же формате, что read_room_data
```

### Экспорт результатов

Добавьте функцию создания отчета:

```python
def create_report(stats):
    # Создание Excel отчета о проделанной работе
    # Список обновленных/созданных блоков
```
