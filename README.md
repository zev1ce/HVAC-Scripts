# Автоматизация переноса данных ОВИК в AutoCAD

Проект для автоматизации переноса расчетных данных воздухообменов и теплопотерь из Excel таблиц в динамические блоки AutoCAD.

## Описание

Инструмент позволяет:
- Читать данные о помещениях из Excel таблиц
- **Выбирать активный документ** из нескольких открытых в AutoCAD
- **Автоматически обновлять** атрибуты существующих динамических блоков
- **Создавать новые блоки** из шаблона с данными из Excel
- **Размещать блоки по сетке** или в заданных координатах
- **Использовать координаты из Excel** для точного позиционирования
- Настраивать соответствие между колонками Excel и атрибутами блоков
- Работать с любой структурой Excel файлов через конфигурацию

## Установка

### Требования
- Python 3.8+
- AutoCAD (любая версия с COM поддержкой)
- Windows (для работы с COM)

### Установка зависимостей
```bash
pip install -r requirements.txt
```

## Структура проекта

```
HVAC Scripts/
├── src/
│   ├── excel_reader.py          # Модуль чтения Excel файлов
│   └── autocad_controller.py    # Модуль управления AutoCAD
├── config/
│   └── block_mapping.json       # Настройки соответствий
├── data/                        # Папка для Excel файлов
├── main.py                      # Главный скрипт
├── requirements.txt             # Зависимости Python
└── README.md                    # Документация
```

## Настройка

### Конфигурация блоков (config/block_mapping.json)

```json
{
  "excel_columns": {
    "room_number": "Номер помещения",
    "room_name": "Наименование", 
    "area": "Площадь, м²",
    "air_supply": "Приток, м³/ч",
    "air_extract": "Вытяжка, м³/ч",
    "heat_loss": "Теплопотери, Вт"
  },
  "block_attributes": {
    "room_number": "ROOM_NUM",
    "room_name": "ROOM_NAME",
    "area": "AREA", 
    "air_supply": "AIR_IN",
    "air_extract": "AIR_OUT",
    "heat_loss": "HEAT_LOSS"
  },
  "target_blocks": [
    "ROOM_DATA",
    "ПОМЕЩЕНИЕ", 
    "ROOM_BLOCK"
  ]
}
```

**Параметры:**
- `excel_columns` - названия колонок в Excel файле
- `block_attributes` - имена атрибутов в блоках AutoCAD
- `target_blocks` - имена блоков, которые нужно обновлять

## Использование

### Сценарий 1: Обновление существующих блоков

**Подготовка:**
1. Разместите блоки помещений в чертеже с заполненными номерами
2. Создайте Excel файл с данными (номера должны совпадать)

**Запуск:**
1. Откройте AutoCAD с чертежом
2. Запустите `python main.py`
3. Выберите документ (если открыто несколько)
4. Укажите путь к Excel файлу
5. Выберите "Обновить существующие блоки"

### Сценарий 2: Создание блоков из шаблона

**Подготовка:**
1. Создайте блок-шаблон с атрибутами в чертеже
2. Подготовьте Excel файл с данными помещений

**Запуск:**
1. Откройте AutoCAD с чертежом-шаблоном
2. Запустите `python main.py`
3. Выберите "Создать новые блоки из шаблона"
4. Выберите блок-шаблон из списка
5. Выберите способ размещения:
   - **По сетке**: автоматическое размещение блоков
   - **По координатам**: точное позиционирование

### Структура Excel файла

**Основные колонки:**
- Номер помещения
- Наименование  
- Площадь, м²
- Приток, м³/ч
- Вытяжка, м³/ч
- Теплопотери, Вт
- Приточная система
- Вытяжная система
- Класс чистоты
- Температура, °C

**Дополнительные колонки (для точного позиционирования):**
- X координата
- Y координата

### Требования к блокам AutoCAD

Блоки должны содержать атрибуты:
- `ROOM_NUM` - номер помещения
- `ROOM_NAME` - наименование
- `AREA` - площадь
- `AIR_IN` - приток воздуха
- `AIR_OUT` - вытяжка воздуха  
- `HEAT_LOSS` - теплопотери
- `P_SYS` - приточная система
- `V_SYS` - вытяжная система
- `CL_CLASS` - класс чистоты
- `TEMP` - температура

## Возможности расширения

### Добавление новых параметров

1. Добавьте колонку в Excel файл
2. Добавьте атрибут в блок AutoCAD
3. Обновите `config/block_mapping.json`:
   ```json
   {
     "excel_columns": {
       "new_param": "Новый параметр"
     },
     "block_attributes": {
       "new_param": "NEW_ATTR"
     }
   }
   ```

### Работа с разными типами блоков

Добавьте имена ваших блоков в `target_blocks`:
```json
{
  "target_blocks": [
    "МОЙ_БЛОК_ПОМЕЩЕНИЯ",
    "ROOM_CUSTOM"
  ]
}
```

## Примеры использования

### Пример Excel файла
Программа автоматически создаст пример файла `data/sample_hvac_data.xlsx` при первом запуске.

### Пример блока AutoCAD
Создайте блок с атрибутами:
- ROOM_NUM (текст)
- ROOM_NAME (текст) 
- AREA (текст)
- AIR_IN (текст)
- AIR_OUT (текст)
- HEAT_LOSS (текст)

## Устранение неполадок

### AutoCAD не найден
- Убедитесь, что AutoCAD запущен
- Проверьте, что открыт документ с блоками

### Блоки не обновляются  
- Проверьте имена блоков в `target_blocks`
- Убедитесь, что атрибуты блоков соответствуют настройкам

### Ошибки чтения Excel
- Проверьте названия колонок в `excel_columns`
- Убедитесь, что файл не открыт в Excel

## Ограничения

- Работает только в Windows (COM интерфейс)
- Требует установленного AutoCAD
- Excel файл должен иметь предсказуемую структуру
- Обновляет только существующие блоки

## Автор

Инструмент создан для упрощения работы проектировщиков ОВИК.

## Лицензия

Свободное использование для образовательных и коммерческих целей.
